@model VirusTotalNet.Results.UrlReport

<h2>Scan Results for URL</h2>

@if (Model != null)
{
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Scan Results</h5>
            <div style="display: flex; align-items: flex-start;">
                <!-- Text section -->
                <div style="flex: 1;">
                    <p><strong>URL (Resource):</strong> @Model.Resource</p>
                    <p><strong>Scan Date:</strong> @Model.ScanDate</p>
                    <p><strong>Positives:</strong> @Model.Positives/@Model.Total</p>
                </div>

                <!-- Pie Chart for Positives vs Non-Positives -->
                <div class="card ml-3 chart-card" style="width: 250px; height: 250px;">
                    <canvas id="positivesChart"></canvas>
                </div>
            </div>

            <!-- Scans List -->
            <h4 style="margin-bottom: 0;">Scans:</h4>
            <ul style="padding-top: 0;">
                @foreach (var scan in Model.Scans)
                {
                    <li>
                        <strong>@scan.Key:</strong> Detected: @scan.Value.Detected
                    </li>
                }
            </ul>
            <p><a href="@Model.Permalink" target="_blank" class="btn btn-primary">View Full Report</a></p>
        </div>
    </div>

    <!-- Include Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Get the Positives and Non-Positives values from the model
        var positives = @Model.Positives; // Number of positives
        var total = @Model.Total; // Total scans
        var nonPositives = total - positives; // Calculate non-positives

        var ctx = document.getElementById('positivesChart').getContext('2d');
        var positivesChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Positives', 'Non-Positives'],
                datasets: [{
                    data: [positives, nonPositives],
                    backgroundColor: ['#ff4b4b', '#4bffa5'], // Red for positives, Green for non-positives
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                    }
                }
            }
        });
    </script>
}
else
{
    <p>No scan data available.</p>
}
<style>
    /* Dark Mode */
    body.dark-mode .card-body {
        background-color: #2c2f3f;
        color: #fff;
    }

    body.dark-mode .chart-card {
        background-color: #2c2f3f;
        color: #fff;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
    }

    /* Light Mode */
    body.light-mode .card-body {
        background-color: #f9f9f9;
        color: #000;
    }

    body.light-mode .chart-card {
        background-color: #f9f9f9;
        color: #000;
        box-shadow: 0 0 15px rgba(0, 123, 255, 0.3);
    }
</style>
